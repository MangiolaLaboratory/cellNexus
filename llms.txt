# cellNexus

`cellNexus` is a query interface for programmatic exploration and
retrieval of harmonised, curated, and reannotated CELLxGENE
human-cell-atlas data.

![cellNexus abstract overview](abstract.png)

This standalone documentation website provides:

- Detailed data-processing information (quality control, harmonisation,
  and expression representations).
- Complete explanations of metadata columns used in filtering and
  interpretation.
- Guided examples for metadata-first exploration and gene-expression
  analysis.

## Start Here

- **Home**: package purpose, architecture, and processing pipeline
  overview.
- **Metadata Explore**: field-by-field metadata dictionary, examples,
  and filtering strategy.
- **Gene Expression Explore**: practical workflows for querying
  single-cell, pseudobulk, and metacell expression.

## Data Processing Overview

The harmonisation pipeline standardises data across datasets so queries
are consistent across studies:

1.  Metadata are retrieved from cloud-hosted harmonised tables.
2.  Standardised quality control removes empty droplets, dead/damaged
    cells, and likely doublets.
3.  Cell-level data are served through common assay layers (`counts`,
    `cpm`, pseudobulk, metacell).
4.  Outputs are returned in analysis-ready R formats such as
    `SingleCellExperiment` and `Seurat`.

For implementation details and code examples, see the vignettes listed
in the top navigation.

## Client Usage Examples

### R client (`cellNexus`)

``` r
library(cellNexus)
library(dplyr)
library(stringr)

metadata <- get_metadata(cloud_metadata = SAMPLE_DATABASE_URL)

query <- metadata |>
  filter(
    empty_droplet == FALSE,
    alive == TRUE,
    scDblFinder.class != "doublet",
    self_reported_ethnicity == "African",
    str_like(assay, "%10x%"),
    tissue == "lung parenchyma",
    str_like(cell_type, "%CD4%")
  )

sce <- get_single_cell_experiment(query, assays = "cpm")
pb <- get_pseudobulk(query)
```

### Python client (`cellNexusPy`)

Python support is available in the companion repository:
[`MangiolaLaboratory/cellNexusPy`](https://github.com/MangiolaLaboratory/cellNexusPy).

``` python
from cellnexuspy import get_metadata, get_anndata

sample_dataset = "https://object-store.rc.nectar.org.au/v1/AUTH_06d6e008e3e642da99d806ba3ea629c5/cellNexus-metadata/sample_metadata.1.3.0.parquet"
conn, table = get_metadata(parquet_url=sample_dataset)

table = table.filter("""
    empty_droplet = 'false'
    AND alive = 'true'
    AND "scDblFinder.class" != 'doublet'
    AND feature_count >= 5000
""")

query = table.filter("""
    self_reported_ethnicity = 'African'
    AND assay LIKE '%10%'
    AND tissue = 'lung parenchyma'
    AND cell_type LIKE '%CD4%'
""")

adata = get_anndata(query, assay="cpm")
pb = get_anndata(query, aggregation="pseudobulk")
conn.close()
```

# Package index

## All functions

- [`SAMPLE_DATABASE_URL`](https://mangiolalaboratory.github.io/cellNexus/reference/SAMPLE_DATABASE_URL.md)
  : URL pointing to the sample metadata file, which is smaller and for
  test, demonstration, and vignette purposes only
- [`calculate_pseudobulk()`](https://mangiolalaboratory.github.io/cellNexus/reference/calculate_pseudobulk.md)
  : Generate pseudobulk counts and quantile_normalised counts
- [`cellNexus-package`](https://mangiolalaboratory.github.io/cellNexus/reference/cellNexus-package.md)
  [`cellNexus`](https://mangiolalaboratory.github.io/cellNexus/reference/cellNexus-package.md)
  : cellNexus: Query Interface for the Human Cell Atlas
- [`create_interface_app()`](https://mangiolalaboratory.github.io/cellNexus/reference/create_interface_app.md)
  : Create a Shiny app that allows users to generate filtering &
  retreival code for cellNexus
- [`get_SingleCellExperiment()`](https://mangiolalaboratory.github.io/cellNexus/reference/get_SingleCellExperiment.md)
  : Gets a SingleCellExperiment from curated metadata
- [`get_default_cache_dir()`](https://mangiolalaboratory.github.io/cellNexus/reference/get_default_cache_dir.md)
  : Returns the default cache directory with a version number
- [`get_metacell()`](https://mangiolalaboratory.github.io/cellNexus/reference/get_metacell.md)
  : Gets a Metacell from curated metadata
- [`get_metadata()`](https://mangiolalaboratory.github.io/cellNexus/reference/get_metadata.md)
  : Gets the CellNexus metadata as a data frame.
- [`get_metadata_url()`](https://mangiolalaboratory.github.io/cellNexus/reference/get_metadata_url.md)
  : Returns the URLs for all metadata files
- [`get_pseudobulk()`](https://mangiolalaboratory.github.io/cellNexus/reference/get_pseudobulk.md)
  : Gets a Pseudobulk from curated metadata
- [`get_seurat()`](https://mangiolalaboratory.github.io/cellNexus/reference/get_seurat.md)
  : Given a data frame of HCA metadata, returns a Seurat object
  corresponding to the samples in that data frame
- [`get_single_cell_experiment()`](https://mangiolalaboratory.github.io/cellNexus/reference/get_single_cell_experiment.md)
  : Gets a SingleCellExperiment from curated metadata
- [`import_one_sce()`](https://mangiolalaboratory.github.io/cellNexus/reference/import_one_sce.md)
  : Import and process metadata and counts for a SingleCellExperiment
  object
- [`metacell_counts`](https://mangiolalaboratory.github.io/cellNexus/reference/metacell_counts.md)
  : Sample Metacell SingleCellExperiment Object
- [`organize_inputs()`](https://mangiolalaboratory.github.io/cellNexus/reference/organize_inputs.md)
  : Organize arbitrary Shiny inputs into a grid layout
- [`pbmc3k_sce`](https://mangiolalaboratory.github.io/cellNexus/reference/pbmc3k_sce.md)
  : Sample SingleCellExperiment Object
- [`pseudobulk_counts`](https://mangiolalaboratory.github.io/cellNexus/reference/pseudobulk_counts.md)
  : Sample Pseudobulk SingleCellExperiment Object
- [`single_cell_counts`](https://mangiolalaboratory.github.io/cellNexus/reference/single_cell_counts.md)
  : Sample SingleCellExperiment Object with Counts Assay
- [`single_cell_cpm`](https://mangiolalaboratory.github.io/cellNexus/reference/single_cell_cpm.md)
  : Sample SingleCellExperiment Object with CPM Assay
- [`sync_metadata_assay_files()`](https://mangiolalaboratory.github.io/cellNexus/reference/sync_metadata_assay_files.md)
  : Synchronize metadata assay files with remote repository
- [`validate_data()`](https://mangiolalaboratory.github.io/cellNexus/reference/validate_data.md)
  : Validate data parameters

# Articles

### Documentation

- [Metadata
  Explore](https://mangiolalaboratory.github.io/cellNexus/articles/metadata-explore.md):
- [Gene Expression
  Explore](https://mangiolalaboratory.github.io/cellNexus/articles/gene-expression-explore.md):
