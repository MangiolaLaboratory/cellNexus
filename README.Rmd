---
title: "HCAquery"
output: github_document
always_allow_html: true
---

Load Metadata

```{r, message=FALSE, warning=FALSE}
library(HCAquery)
library(dplyr)
library(dbplyr)
library(SingleCellExperiment)
library(tidySingleCellExperiment)
```

Load the data

```{r}
hca_metadata = get_metadata()
```

Explore the HCA content

```{r}
hca_metadata |> 
	distinct(tissue, file_id) |> 
	count(tissue) |> 
	arrange(desc(n))
```

Query

```{r}
options("restore_SingleCellExperiment_show" = TRUE)
sce = 
	hca_metadata |> 
    filter(cell_type %LIKE% "%CD4%" ) |> 
    as_tibble() |> 
    unite("file_id_db", c(file_id, cell_type), remove = FALSE) |>
    mutate(file_id_db = file_id_db |> md5() |> as.character()) |> 
	
	get_SingleCellExperiment("/vast/projects/RCP/human_cell_atlas/splitted_DB2_data")
	
sce
```


