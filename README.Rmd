---
title: "HCAquery"
output: github_document
always_allow_html: true
---

Load Metadata

```{r}
library(HCAquery)
library(tidyverse)
library(SingleCellExperiment)
library(tidySingleCellExperiment)
hca_metadata = readRDS("/vast/scratch/users/mangiola.s/human_cell_atlas/metadata.rds")
options("restore_SingleCellExperiment_show" = TRUE)
```



```{r}
hca_metadata |> 
	distinct(.sample)
```

```{r}
hca_metadata |> 
	  distinct(file_id)
```

```{r}
hca_metadata |> 
	  nrow()
```

```{r}
hca_metadata |> 
	  distinct(cell_type)
```
```{r}
hca_metadata |> 
	distinct(tissue, file_id) |> 
	count(tissue) |> 
	arrange(desc(n))
```

Query

```{r}
sce = 
	hca_metadata |> 
	filter(
		ethnicity == "African" & 
		assay |> str_detect("10x") & 
		tissue == "lung parenchyma" & 
		cell_type |> str_detect("CD4")
	) |> 
	get_SingleCellExperiment()
	
sce
```


